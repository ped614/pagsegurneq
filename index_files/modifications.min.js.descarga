!function(){"use strict";const e="exponea-experiments-editor",t={version:"v2.79.4",status:200,errorDetail:undefined,instanceId:"ntn",sdk:{},sdkObjectName:"",path:"",sign:"",rootElement:document.documentElement,makeAsyncCall:false,cookie:"867557c5-f3d4-46bc-9bff-d8954b85a34a",cookieOptions:{"domain":"","path":""},data:[],vars:{"data":[]},asyncCallVars:[],featureFlags:["ewx_498_observer_refactor"]};class n{static get window(){return window}static get document(){return document}}const r="_webxp_";function i(e,t){n.window.location.search.match(/[?&]exponea_debug(&|=|$)/)&&((new Date).toUTCString(),console.log(function(e){return"WebXP ["+(new Date).toUTCString()+"] "+e}(e)),void 0!==t&&console.log(t))}const s=()=>{};function o(e){return"function"==typeof e}function a(){return"loading"!==document.readyState}function c(e){return null!==(t=e)&&"object"==typeof t&&o(e.remove);var t}function l(e,t){for(const n in e)e.hasOwnProperty(n)&&t(e[n],n,e);return e}function u(e,t){try{return e.matches(t)}catch(e){return!1}}function d(e){const t=e.element;try{const n=document.querySelectorAll(t);return 0===n.length&&("remove"===e.type&&i("The selector matched no elements, ignoring the remove modification",t),"run"!==e.type&&"banner"!==e.type||i("The selector matched no elements but still applying "+e.type+" modification",t)),n}catch(n){return"run"===e.type||"banner"===e.type?i("Invalid selector but still applying the "+e.type+" modification",t):i("Invalid selector of the "+e.type+" modification",t),[]}}function p(e){const t=document.createElement("div");t.innerHTML=e;const n=document.createDocumentFragment();for(;t.firstChild;)n.appendChild(t.firstChild);return n}function h(e){const t=[];for(let n=0;n<e.childNodes.length;n++)t.push(e.childNodes[n]);return t}function f(e,t){return function(e){const t=[];let n=e.parentElement,r=0;for(;n&&r<1e3;)t.push(n),n=n.parentElement,r++;return t}(e).some((e=>{var n;return null===(n=t.applied)||void 0===n?void 0:n.has(e)}))||function(e){const t=[],n=e.parentNode;if(!n)return t;const r=n.childNodes;for(let n=0;n<r.length;n++)r[n]!==e&&r[n].nodeType===Node.ELEMENT_NODE&&t.push(r[n]);return t}(e).some((e=>{var n;return null===(n=t.applied)||void 0===n?void 0:n.has(e)}))}function m(e,t){const n="before"===t||"after"===t?e.parentElement:e;let r=null;if(n)switch(t){case"before":r=e;break;case"after":r=e.nextSibling;break;case"prepend_child":r=e.firstChild;break;default:r=null}return{parentElement:n,nodeBefore:r}}function g(e,t){"length"in e||(e=[e]),[].forEach.call(e,(function(e){1===e.nodeType&&t(e)}))}function v(e){return r+e}const y=r+"list";function b(e,t){g(e,(e=>{e[y]||(e[y]=[]),-1===e[y].indexOf(t)&&e[y].push(t)}))}function x(e,t){g(e,(e=>{if(!e[y])return;const n=e[y].indexOf(t);-1!==n&&e[y].splice(n,1)}))}function _(e,t){return e[y]&&-1!==e[y].indexOf(t)}function w(){return!!document.getElementById(e)}function E(e,t,n,r){const i={};if(i.inPreview=w(),i.sdk=n,i.data=i.params=t,r)i.element=r,i.elements=[r];else{const t=d(e);t&&t.length>0?(i.element=t[0],i.elements=[].slice.call(t)):(i.element=null,i.elements=[])}i.selector=e.element;const s="parametrized_parts"in e?e.parametrized_parts.script:e.script,o=new Function(s).bind(i);return o.context=i,o}const O=e=>e/1e3;function S(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o}function k(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function I(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;class N{constructor(){this.subscribers=new Map,this.numberOfEvents=0}subscribe(e,t){var n;const r=null!==(n=this.subscribers.get(e))&&void 0!==n?n:new Map,i=++this.numberOfEvents;return r.set(i,t),this.subscribers.set(e,r),{unsubscribe:()=>r.delete(i)}}publish(e,t){var n;const r=null!==(n=this.subscribers.get(e))&&void 0!==n?n:new Map;for(const[,e]of r)e(t)}}function C(e,t){var n;const r="add_modification",i=t.parametrized_parts?t.parametrized_parts.html:t.html;if(t.applied||(t.applied=new Map),t.applied.has(e)||_(e,r)&&f(e,t))return s;const o=p(i),{parentElement:a,nodeBefore:c}=m(e,t.place_to.placement);if(!a)return s;const l=h(o);return b(o.childNodes,r),null===(n=null==t?void 0:t.applied)||void 0===n||n.set(e,!0),a.insertBefore(o,c),()=>{var n;l.forEach(P),null===(n=t.applied)||void 0===n||n.set(e,!1)}}function P(e){e.parentNode?e.parentNode.removeChild(e):i("Cannot remove an inserted element because its original parent is missing.")}function T(e){let t=s;return e.parentElement&&(t=A.bind(window,e,e.parentElement,e.nextElementSibling),e.parentElement.removeChild(e)),t}function $(e,t){if("visibility"===t.method){const t=e.style.visibility;return e.style.visibility="hidden",()=>{e.style.visibility=t}}if("display"===t.method){const t=e.style.display;return e.style.display="none",()=>{e.style.display=t}}return()=>{}}function A(e,t,n){t?t.insertBefore(e,n):i("Cannot re-insert a removed element because its original parent is missing.")}function L(e,t){if(t.html&&!_(e,t)){const n=p(t.parametrized_parts?t.parametrized_parts.html:t.html),{parentElement:r}=m(e,"before");if(r){const i=h(n);return b(n.childNodes,t),r.insertBefore(n,e),r.removeChild(e),j.bind(window,e,r,i)}}return s}function j(e,t,n){t?(A(e,t,n[0]),n.forEach(P)):i("Cannot re-insert a removed element because its original parent is missing.")}function M(e,t){const n=e.innerHTML;return t.text&&!_(e,t)?(e.innerText=t.text,b(e,t),R.bind(window,e,n,t)):s}function R(e,t,n){x(e,n),e.innerHTML=t}function D(e){const t=[],n=d(e);if(n.length>0&&e.place_to){const r=function(e){let t;try{t=document.querySelector(e)}catch(t){return i("Invalid selector, ignoring the add modification",e),!1}return t||(i("No element matched the selector, ignoring the modification",e),null)}(e.place_to.element);if(r){const{parentElement:i,nodeBefore:s}=m(r,e.place_to.placement);i&&[].forEach.call(n,(function(n){_(n,e)||(t.push(F.bind(window,n,n.parentElement,n.nextSibling,e)),i.insertBefore(n,s),b(n,e))}))}}return t}function F(e,t,n,r){t?(x(e,r),A(e,t,n)):i("Cannot move back element because its original parent is missing.")}function B(e,t){const n=[];return t.style?(e.hasAttribute("style")||n.push((()=>{e.removeAttribute("style")})),l(t.style,((t,r)=>{const i=e.style.getPropertyValue(r);e.style.setProperty(r,t,"important"),n.push(i?()=>{e.style.setProperty(r,i)}:()=>{e.style.removeProperty(r)})})),()=>{n.forEach((e=>e()))}):()=>{}}function q(e,t){if(!t.attributes)return()=>{};const n={};return l(t.attributes,((t,r)=>{var i;n[r]=e.getAttribute(r),function(e,t){return v(t)in e&&!0===e[v(t)]}(e,"alreadySetAttribute_"+r)||("src"!==r&&"srcset"!==r||e.setAttribute(r,""),e.setAttribute(r,t),i="alreadySetAttribute_"+r,g(e,(e=>{e[v(i)]=!0})))})),V.bind(window,e,n,t)}function V(e,t,n){n.attributes&&l(n.attributes,((r,s)=>{if(n.attributes&&e.getAttribute(s)===n.attributes[s]){const n=t[s];null==n?e.removeAttribute(s):e.setAttribute(s,n)}else i("Attribute `"+s+"` was not reverted because it changed value in meantime.");var o;o="alreadySetAttribute_"+s,g(e,(e=>{delete e[v(o)]}))}))}function Q(e,t,n,r){try{if(r&&_(r,e))return()=>{};const i=E(e,t,n,r)();return r&&b(r,e),()=>{r&&x(r,e),o(i)?i():c(i)&&i.remove.call(i)}}catch(e){return i("The run modification script threw an error",e),()=>{}}}function H(e,t,n){try{const r=E(e,t,n);e.parametrized_parts?(r.context.html=e.parametrized_parts.html,r.context.style=e.parametrized_parts.style):(r.context.html=e.html,r.context.style=e.style);const i=r();return c(i)?i.remove.bind(i):()=>{}}catch(e){return i("The banner modification script threw an error",e),()=>{}}}function z(e){let t=[],n=`/* Experiment: ${e.params.experiment_name} (id: ${e.params.experiment_id}) */`,r=`/* Variant: ${e.params.variant_name} (id: ${e.params.variant_id}) */`;if(e.modifications.forEach((function(e){const i=[];if("change"===e.type&&e.style)for(const t in e.style)e.style.hasOwnProperty(t)&&i.push("\t"+t+": "+e.style[t]+" !important;");else"remove"!==e.type||"display"!==e.method&&"visibility"!==e.method||i.push("\t"+e.method+": "+("display"===e.method?"none":"hidden")+" !important;");i.length>0&&("change"===e.type||"remove"===e.type)&&(n&&(t.push(n),n=""),r&&(t.push(r),r=""),t=[...t,e.element+" {",...i,"}"])})),t.length>0){const e=document.createElement("style");return e.type="text/css",e.innerHTML=t.join("\n"),document.getElementsByTagName("head")[0].appendChild(e),P.bind(window,e)}return s}var K;function W(e,t,n=void 0){const r=(i=/[\[\]\.]/,t.split(i).filter(Boolean).reduce(((e,t)=>null!=e?e[t]:e),e));var i;return void 0===r?n:r}!function(e){e.isDataLayerVariable=function(e){return"data_layer"===e.variable.type},e.isQueryParameterVariable=function(e){return"query"===e.variable.type},e.isJavaScriptVariable=function(e){return"global_variable"===e.variable.type},e.isCustomFunction=function(e){return"custom_function"===e.variable.type}}(K||(K={}));const J="dataLayer";var U,G,X,Y,Z,ee,te;function ne(e,t){return e.data.find((e=>e.id===t))}function re(e,t){const n=function(e){const t={};return new URL(e).searchParams.forEach(((e,n)=>{t[n]=decodeURIComponent(e)})),t}(t);if(0===Object.keys(n).length)return;const r=e.variable.query.key;if(!r)return;return n[r]}function ie(e,t=window){let n;return K.isDataLayerVariable(e)?n=function(e,t){const n=t[J];if(!n)return;const r=e.variable.data_layer.name;if(r)for(let e=n.length-1;e>=0;e--){const t=W(n[e],r,void 0);if(t)return t}}(e,t):K.isQueryParameterVariable(e)?n=re(e,t.location.href):K.isJavaScriptVariable(e)?n=function(e,t){const n=e.variable.global_variable.name;if(!n)return;return W(t,n,void 0)||void 0}(e,t):K.isCustomFunction(e)&&(n=function(e){const t=e.variable.custom_function.body;if(!t)return;let n,r;try{n=new Function(t)}catch(e){return}try{r=n()}catch(e){return}return r}(e)),n}!function(e){e.matches=function(e,t,n,r=window){return!n||n.every((n=>{let i;if(!t)return!1;try{const s=n.attribute.id,o=ne(t,s);if(!o)return!1;i=ie(o,r);const a={};return void 0!==i&&(a[s]=i),e(a,s,n.constraint)}catch(e){return!1}}))},e.evaluatePageVars=function(e,t,n=window){if(!e)return;const r={};var i;return t.forEach((t=>{const i=t.id,s=ne(e,i);if(!s)return;const o=ie(s,n);void 0!==o&&(r[i]=o)})),i=r,Object.entries(i||{}).length||(null==i?void 0:i.length)||(null==i?void 0:i.size)?r:void 0}}(U||(U={})),function(e){e.ewx_498_observer_refactor="ewx_498_observer_refactor"}(G||(G={}));class se{constructor(){this.revertObjects=[]}add({fn:e,experimentId:t,trigger:n}){"function"==typeof e?this.revertObjects.push({fn:e,experimentId:t,trigger:n}):this.revertObjects=[...this.revertObjects,...e.map((e=>({fn:e,experimentId:t,trigger:n})))]}revert(){for(let e=this.revertObjects.length-1;e>=0;e--)try{this.revertObjects[e].fn()}catch(e){i("Error from revert experiment script",e)}this.revertObjects=[]}revertExperiment(e){this.revertRelevant((t=>t.experimentId===e))}revertAllByTrigger(e){this.revertRelevant((t=>t.trigger===e))}revertRelevant(e){var t;this.revertObjects.filter(e).map((e=>e.fn)).forEach((e=>{try{e()}catch(e){i("Error from revert experiment script",e)}})),this.revertObjects=this.revertObjects.filter((t=e,e=>!t(e)))}}function oe(e,t,n){return I(this,void 0,void 0,(function*(){let r,s;i(`${(null==n?void 0:n.method)||"GET"} ${t} (payload: ${null==n?void 0:n.body})`);try{r=yield e.fetch(t,n)}catch(e){throw i(`Error ${(null==n?void 0:n.method)||"GET"} to ${t}.`,e),e}if(!(null==r?void 0:r.ok))throw i(`Error: Received ${null==r?void 0:r.status} from ${t}`),new Error(`Received ${null==r?void 0:r.status} from ${t}`);try{s=yield r.json()}catch(e){throw i(`Error: Unable to create JSON from ${t}`),e}return s}))}class ae{static isSupported(){if(void 0!==this.cachedIsSupported)return this.cachedIsSupported;try{const e="__storage_test_sample__";return this.getStorage().setItem(e,e),this.getStorage().removeItem(e),this.cachedIsSupported=!0,!0}catch(e){return this.cachedIsSupported=!1,!1}}static getItem(e){return this.isSupported()?this.getStorage().getItem(e):null}static setItem(e,t){this.getStorage().setItem(e,t)}static removeItem(e){this.getStorage().removeItem(e)}static getStorage(){return window.localStorage}}ae.cachedIsSupported=void 0;class ce{static getLastShow(e,t){const n=ae.getItem(this.getLastShowKey(e,t));return n?parseInt(n,10):null}static setLastShow(e,t){const n=""+Date.now();ae.setItem(this.getLastShowKey(e,t),n)}static getLastSessionStart(e){const t=ae.getItem(this.getLastSessionStartKey(e));return t?parseInt(t,10):null}static getLastShowKey(e,t){return this.getEventKeyPrefix(t)+e+"_last_show"}static getEventKeyPrefix(e){return this.getPrefix(e)+"_experiment_event__"}static getLastSessionStartKey(e){return this.getPrefix(e)+"_last_session_start_timestamp__"}static getPrefix(e){let t=e.replace(/^_/,"");return"infinario"===t&&(t="inf"),"__"+t}}function le(){return function(t,n,r){try{const i=r.type,s=r.operator,o=r.operands;if(X.whitelist.indexOf(s)>-1)return function(e,t,n,r){const i=e[n];switch(r){case X.isSet:return null!=i;case X.isNotSet:return null==i;case X.hasValue:return ue(t)?(null==i?void 0:i.length)>0:i+""!="";case X.hasNoValue:return ue(t)?0===(null==i?void 0:i.length):i+""==""}return!1}(t,i,n,s);if(function(e){return"string"===e}(i))return function(t,n,r,i){if(-1===Y.whitelist.indexOf(r))return e(r,"string"),!1;const s=t[n]+"";let o;switch(r){case Y.equals:return s===i[0].value;case Y.doesNotEqual:return s!==i[0].value;case Y.isIn:return o=i.map((e=>e.value)),o.indexOf(s)>-1;case Y.isNotIn:return o=i.map((e=>e.value)),-1===o.indexOf(s);case Y.contains:return s.indexOf(i[0].value)>-1;case Y.doesNotContain:return-1===s.indexOf(i[0].value);case Y.startsWith:return s.startsWith(i[0].value);case Y.endsWith:return s.endsWith(i[0].value);case Y.matchesRegex:return null!==new RegExp(i[0].value).exec(s)}return!1}(t,n,s,o);if(function(e){return"number"===e}(i))return function(t,n,r,i){if(-1===Z.whitelist.indexOf(r))return e(r,"number"),!1;const s=parseFloat(t[n]+""),o=parseFloat(i[0].value);switch(r){case Z.equalTo:return s===o;case Z.inBetween:return o<=s&&s<=parseFloat(i[1].value);case Z.lessThan:return s<o;case Z.greaterThan:return s>o}return!1}(t,n,s,o);if(function(e){return"boolean"===e}(i))return function(t,n,r,i){if(-1===ee.whitelist.indexOf(r))return e(r,"boolean"),!1;const s=t[n]+"",o=i.value+"";if(r===ee.is)return s===o;return!1}(t,n,s,r);(function(e){return"date"===e})(i)&&console.error("Value filter: Date type is not supported."),ue(i)&&console.error("Value filter: List type is not supported.")}catch(e){i("Value filter error:",e)}return i("Invalid value filter:",r.operator),!1};function e(e,t){console.error("Contextual Bandits: operation "+e+" not suported for type "+t+".")}}function ue(e){return"list"===e}function de(e){return function(t){var n;return pe(t.params.experiment_id,t.frequency,e.sdkObjectName)&&function(e,t,n){if(!t||w())return!0;const r=e.experiment_id;try{const s=function(e,t,n){const r={};r.inPreview=w(),r.sdk=t,r.data=r.params=e;let i=n;i.length>0&&i.indexOf("\n")<0&&i.indexOf(";")<0&&i.indexOf("return")<0&&(i="return "+i);const s=new Function(i).bind(r);return s.context=r,s}(e,n,t);return s()||i(`Experiment ${r} was filtered out because of custom condition  ${t}.`),!!s()}catch(e){return i(`Custom condition for experiment ${r} threw an error`,e),!1}}(t.params,t.custom_condition,e.sdk)&&he(null===(n=t.variables_target)||void 0===n?void 0:n.conditions,e.vars)}}function pe(e,t,n){if(w())return!0;const r=ce.getLastShow(e,n),s=ce.getLastSessionStart(n);if(!ae.isSupported()&&("only_once"===t||"once_per_visit"===t))return i(`Can't apply experiment ${e} due to missing browser local storage support.`),!1;switch(t){case"only_once":return r&&i(`Experiment ${e} was filtered out because of its frequency only_once.`),!r;case"once_per_visit":return r&&s&&r>=s&&i(`Experiment ${e} was filtered out because of its frequency once_per_visit.`),!r||!s||r<s;default:return!0}}function he(e,t){const n=le();return U.matches(n,t,e)}!function(e){e.isSet="is set",e.isNotSet="is not set",e.hasValue="has value",e.hasNoValue="has no value",e.whitelist=[e.isSet,e.isNotSet,e.hasValue,e.hasNoValue]}(X||(X={})),function(e){e.equals="equals",e.doesNotEqual="does not equal",e.isIn="in",e.isNotIn="not in",e.contains="contains",e.doesNotContain="does not contain",e.startsWith="starts with",e.endsWith="ends with",e.matchesRegex="regex",e.whitelist=[e.equals,e.doesNotEqual,e.isIn,e.isNotIn,e.contains,e.doesNotContain,e.startsWith,e.endsWith,e.matchesRegex]}(Y||(Y={})),function(e){e.equalTo="equal to",e.inBetween="in between",e.lessThan="less than",e.greaterThan="greater than",e.whitelist=[e.equalTo,e.inBetween,e.lessThan,e.greaterThan]}(Z||(Z={})),function(e){e.is="is",e.whitelist=[e.is]}(ee||(ee={})),function(e){e.matches=function(e,t){return!t.enabled||!(t.from_date&&t.from_date>O(e))&&!(t.to_date&&t.to_date<O(e))}}(te||(te={}));var fe={exports:{}};fe.exports=be;var me=fe.exports.isMobile=be;fe.exports.default=be;const ge=/(android|bb\d+|meego).+mobile|armv7l|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series[46]0|samsungbrowser.*mobile|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i,ve=/CrOS/,ye=/android|ipad|playbook|silk/i;function be(e){e||(e={});let t=e.ua;if(t||"undefined"==typeof navigator||(t=navigator.userAgent),t&&t.headers&&"string"==typeof t.headers["user-agent"]&&(t=t.headers["user-agent"]),"string"!=typeof t)return!1;let n=ge.test(t)&&!ve.test(t)||!!e.tablet&&ye.test(t);return!n&&e.tablet&&e.featureDetect&&navigator&&navigator.maxTouchPoints>1&&-1!==t.indexOf("Macintosh")&&-1!==t.indexOf("Safari")&&(n=!0),n}var xe,_e;function we(e,t,n,r){try{return(e=>_e.matches(n.href,e.trigger))(e)&&(e=>te.matches((new Date).valueOf(),e.date_filter))(e)&&(e=>xe.matches(e.device_target,r))(e)&&(e=>pe(e._id,e.frequency,t.sdkObjectName))(e)&&(e=>{var n;return he(null===(n=e.variables_target)||void 0===n?void 0:n.conditions,t.vars)})(e)}catch(e){return!1}}function Ee(e,t,n,r,s){let o=[];return setInterval((()=>{o=o.filter((e=>!e.toBeInvalidated))}),15e3),function(a,c,l){var u,d,p;return I(this,void 0,void 0,(function*(){const h=null===(p=null===(d=null===(u=a.sdk)||void 0===u?void 0:u.configuration)||void 0===d?void 0:d.customer)||void 0===p?void 0:p.cookie;h&&(a.cookie=h,a.sign=a.sign.split("/")[0]+"/"+a.cookie);const f=yield n,m=e=>t=>t.id===e;return f.forEach((n=>{if(!function(e,t,n){var r,i,s;const o=null===(r=null==e?void 0:e.trigger_event)||void 0===r?void 0:r.type;if(o!==t)return!1;if("datalayer_event"===o){const t=null==n?void 0:n.event;return(null===(s=null===(i=null==e?void 0:e.trigger_event)||void 0===i?void 0:i[o])||void 0===s?void 0:s.event)===t}return!1}(n,c,l))return;if(!we(n,a,e,t))return s(n._id),void(o.find(m(n._id))&&(o=function(e,t){const[n,r]=(i=e,s=e=>e.id===t,i.reduce(((e,t)=>(e[s(t)?0:1].push(t),e)),[[],[]]));var i,s;return n.forEach((e=>e.cancel())),r}(o,n._id)));if(o.find(m(n._id)))return;const u=function(e,t,n){i(`Loading experiment ${e}`);const[r,s]=n.sign.split("/"),o=`${n.path}/campaigns/experiments/show`,a=new AbortController,c=a.signal,l=(()=>I(this,void 0,void 0,(function*(){var i;let a={};if(null==t?void 0:t.length){const e=U.evaluatePageVars(n.vars,t);e&&(a={page_vars:e})}const l=yield oe(window,o,{method:"POST",body:JSON.stringify(Object.assign({company_id:r,customer_ids:{cookie:s},personalisation_ids:[e]},a)),signal:c});if(0===(null===(i=null==l?void 0:l.data)||void 0===i?void 0:i.length)&&(null==l?void 0:l.success))return l.data[0];if(!(null==l?void 0:l.data)||1!==l.data.length)throw new Error(`Received unexpected response data from ${o}`);return l.data[0]})))();return{id:e,cancel:()=>a.abort(),promise:l,toBeInvalidated:!1}}(n._id,n.page_vars,a);o.push(u),u.promise.then((e=>{e?(u.toBeInvalidated=!1,r(e)):u.toBeInvalidated=!0})).catch(i)})),o}))}}function Oe(e,t){const n={};function r(e){return e.params.experiment_id+"_"+e.params.variant_id}e.forEach((e=>{n[r(e)]=e})),t.forEach((t=>{const i=r(t);n[i]?n[i].modifications=[...n[i].modifications,...t.modifications]:e.push(t)}))}!function(e){e.matches=function(e,t){if(!e)return!0;const n=me({ua:t,tablet:!0,featureDetect:!0});return"mobile"===e.type?n:"desktop"!==e.type||!n}}(xe||(xe={})),function(e){function t(e){const t={source:e};let n;const r=/^(.{1,5}?):\/\//;(n=r.exec(e))&&(t.protocol=n[1],e=e.replace(r,"")),e.startsWith("//")&&(e=e.substr(2));const i=/(.*?)(\/|$)/;if(n=i.exec(e)){const r=n[1].split(":");""!==r[0]&&(t.host=r[0]),r.length>1&&(t.port=r[1]),e=e.replace(i,"/")}const s=/(.*?)(\?|$|#)/;(n=s.exec(e))&&(t.path=n[1],e=e.replace(s,n[2]));const o=/^\?(.*?)($|#)/;(n=o.exec(e))&&(t.query=n[1],e=e.replace(o,n[2]));if((n=/^#(.*)/.exec(e))&&(t.hash=n[1]),t.withoutHost=t.path,t.query&&(t.withoutHost+=`?${t.query}`),t.hash&&(t.withoutHost+=`#${t.hash}`),t.host){const e=t.port?`:${t.port}`:"";t.withoutProtocol=`//${t.host}${e}${t.withoutHost}`}return t}function n(e){const t="^"+function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}(e)+"$",n=t.replace(new RegExp("\\\\\\*","g"),".*");return new RegExp(n)}function r(e,r){return"any"===r.type||("exact"===r.type?function(e,r){const i=t(e),s=t(r);return!(s.host||!s.withoutHost||!i.withoutHost||!i.withoutHost.match(n(s.withoutHost)))||!(s.protocol||!s.withoutProtocol||!i.withoutProtocol||!i.withoutProtocol.match(n(s.withoutProtocol)))||!!i.source.match(n(s.source))}(e,r.url):"contains"===r.type?function(e,t){return e.includes(t)}(e,r.url):"regex"===r.type&&function(e,n){try{const r=new RegExp(n);if(e.match(r))return!0;const i=t(e);return!(!i.withoutProtocol||!i.withoutProtocol.match(r))||!(!i.withoutHost||!i.withoutHost.match(r))}catch(e){if(e instanceof Error)return!1;throw e}}(e,r.regex))}e.matches=function(e,t){if("page"in t)return r(e,t.page);if(t.exclude_pages)for(const n of t.exclude_pages)if(r(e,n))return!1;if(t.include_pages)for(const n of t.include_pages)if(r(e,n))return!0;return!1}}(_e||(_e={}));class Se{start(){}stop(){}}class ke{constructor(e,t,n){this.isObserving=!1,this.config={childList:!0,subtree:!0,attributes:!0,characterData:!1},this.target=e,this.observer=new MutationObserver(this.observerHandler.bind(this)),this.observerCallback=t,this.isObserverFlagOn=n}start(){this.isObserving||(this.observer.observe(this.target,this.config),this.isObserving=!0)}stop(){this.isObserving&&(this.observer.disconnect(),this.isObserving=!1)}observerHandler(e){if(this.isObserverFlagOn){this.observerCallback();const e=this.observer.takeRecords();this.stop(),e.length&&this.observerCallback()}else for(let t,n=0;n<e.length;n++)t=e[n],"childList"===t.type&&t.addedNodes.length>0?[].forEach.call(t.addedNodes,(e=>{1===e.nodeType&&this.observerCallback(e,"childList")})):"attributes"===t.type&&this.observerCallback(t.target,"attributes");this.start()}}function Ie(e){return("0"+e.toString(16)).slice(-2)}function Ne(e,t=window){if(e%2)throw new Error("The length of the random string should be an even number!");const n=t.crypto||t.msCrypto;if(n&&n.getRandomValues&&Array.from){const t=new Uint8Array(e/2);return n.getRandomValues(t),Array.from(t,Ie).join("")}let r="";for(let t=0;t<e/2;t++)r+=Ie(Math.round(256*Math.random()));return r}function Ce(e,t,n){const r=n.value;return n.value=function(){try{return r.apply(this,arguments)}catch(e){let t;t=e instanceof Error?e:new Error(String(e));const n=this.config.instanceId,i=this.config.version;let s;try{s=this.config.sign.split("/")[0]}catch(e){s="00000000-0000-0000-0000-000000000000"}const o={id:Ne(32),instance_id:n,sdk_version:i,company_id:s,spans:[{id:Ne(16),start_time:Date.now()/1e3,duration:1,operation:"webxpClient."+r.name,error:{message:t.message,name:t.name,stack:t.stack||""},tags:{url:location.href.split(/[?#]/)[0],host:location.hostname}}]};throw navigator.sendBeacon("//sdk-tracing.exponea.com/webxp-trace/record/browser/v1",JSON.stringify(o)),e}},n}function Pe(e,t){e.forEach((e=>t(e)))}function Te(e,t){t.dataLayer=t.dataLayer||[];!function(e,t,n=!0){if(!Array.isArray(e))return;const r=e.push;if(e.push=(...n)=>{const s=r.apply(e,n);try{Pe(n,t)}catch(e){i(`Error in dataLayer.push listener occurred: ${e}`)}return s},n)try{e.forEach((e=>Pe([e],t)))}catch(e){i(`Error in dataLayer forEach method occurred: ${e}`)}}(t.dataLayer,(t=>{t&&"object"==typeof t&&(i(`DataLayer event triggered: ${JSON.stringify(t)}`),e("datalayer_event",t))}),!0)}var $e;!function(e){e.triggerTypes=["page_load","datalayer_event","manual"]}($e||($e={}));class Ae{constructor(e){var t;this.config=e,this.pubSub=new N,this.experiments=[],this.alreadyTrackedExperimentsById={},this.isObserverFlagOn=!!(null===(t=this.config.featureFlags)||void 0===t?void 0:t.includes(G.ewx_498_observer_refactor)),this.revertQueue=new se,this.config.legacyFlickeringMode?this.observer=new Se:this.observer=new ke(e.rootElement,((e,t)=>{if(this.isObserverFlagOn)this.applyExperimentsOnAllElements();else{this.applyAllExperiments(e);const n=!!window.webxpClientReactExperimentalSupport;"childList"===t&&(n||a())&&e.firstElementChild&&this.traverseNode(e.firstElementChild)}}),this.isObserverFlagOn),this.metaDataPromise=function(e){return I(this,void 0,void 0,(function*(){const t=e.sign.split("/")[0],n=e.path+"/webxp/projects/"+t+"/bundle";let r;try{r=yield oe(window,n)}catch(e){}let i=[];return(null==r?void 0:r.experiments)&&(i=r.experiments),i}))}(this.config);const n=Ee(location,window.navigator.userAgent,this.metaDataPromise,(e=>this.startExperiment(e)),(e=>this.stopExperiment(e)));this.pubSub.subscribe("datalayer_event",(e=>n(this.config,"datalayer_event",e))),Te(this.pubSub.publish.bind(this.pubSub),window)}init(e=!1,t="page_load"){if(200!==this.config.status&&i("Web modifications ended up with status "+this.config.status),!this.config.skipExperiments)return i("Experiments was not applied by non-flickering script because skipExperiments=false"),void this.revealPage();this.config.cookie&&(this.config.sign=this.config.sign.split("/")[0]+"/"+this.config.cookie),this.config.sdk.initialize(!1),this.applyExperiments(this.config.data,!0),this.loadRemainingDataIfNeeded(e,t),this.revealPage()}applyModifications(e){return this.config.legacyFlickeringMode||this.revert(),this.config.data=[e],this.experiments=[],this.config.status=200,this.applyExperiments(this.config.data,!1),()=>{this.revert()}}reset(e){var t,n;const r=e=>"datalayer_event"===e.trigger_type;this.observer.stop(),this.revertQueue.revertAllByTrigger("page_load"),this.experiments=this.experiments.filter(r),this.config.data=this.config.data.filter(r),this.config.cookie=(null===(n=null===(t=this.getSDK().configuration)||void 0===t?void 0:t.customer)||void 0===n?void 0:n.cookie)||"",e&&$e.triggerTypes.includes(e)||(e="manual"),this.init(!0,e)}revert(){this.observer.stop(),this.revertQueue.revert(),this.experiments=[]}applyModificationOnElement(e,t,n){const r=n.params.experiment_id;if("add"===t.type&&u(e,t.place_to.element))this.revertQueue.add({fn:C(e,t),experimentId:r,trigger:n.trigger_type});else if("change"===t.type||"run"===t.type){const s=u(e,t.element);"change"===t.type?((s||t.place_to&&u(e,t.place_to.element))&&(t.html&&(this.isObserverFlagOn||this.observer.stop(),this.revertQueue.add({fn:L(e,t),experimentId:r,trigger:n.trigger_type})),t.text&&this.revertQueue.add({fn:M(e,t),experimentId:r,trigger:n.trigger_type}),t.place_to&&this.revertQueue.add({fn:D(t),experimentId:r,trigger:n.trigger_type}),t.attributes&&(i=t.attributes,0!==Object.keys(i).length||i.constructor!==Object)&&(this.isObserverFlagOn||this.observer.stop(),this.revertQueue.add({fn:q(e,t),experimentId:r,trigger:n.trigger_type}))),t.style&&s&&(this.isObserverFlagOn||this.observer.stop(),this.revertQueue.add({fn:B(e,t),experimentId:r,trigger:n.trigger_type}))):"run"===t.type&&"once_per_element"===t.execute&&s&&this.revertQueue.add({fn:Q(t,n.params,this.getSDK(),e),experimentId:r,trigger:n.trigger_type})}else"remove"===t.type&&"remove"===t.method&&u(e,t.element)?this.revertQueue.add({fn:T(e),experimentId:r,trigger:n.trigger_type}):"remove"===t.type&&("visibility"===t.method||"display"===t.method)&&u(e,t.element)&&this.config.legacyFlickeringMode&&this.revertQueue.add({fn:$(e,t),experimentId:r,trigger:n.trigger_type});var i}applyExperiments(e,t){const n=JSON.parse(JSON.stringify(e)),r=t?n.filter(de(this.config)):n;this.observer.stop(),i("Applying experiments ...",r),this.trackExperiments(r),this.applyOneTimeModifications(r),this.applyOnDocumentReadyModifications(r),Oe(this.experiments,r),this.isObserverFlagOn?(this.observer.start(),this.applyExperimentsOnAllElements()):(this.reapplyExperiments(),this.observer.start())}applyOneTimeModifications(e){e.forEach((e=>{const t=e.params.experiment_id;this.revertQueue.add({fn:z(e),experimentId:t,trigger:e.trigger_type}),e.modifications.forEach((n=>{"run"===n.type&&"immediately"===n.execute&&this.revertQueue.add({fn:Q(n,e.params,this.getSDK()),experimentId:t,trigger:e.trigger_type})}))}))}applyOnDocumentReadyModifications(e){var t;t=()=>{e.forEach((e=>{const t=e.params.experiment_id;e.modifications.forEach((n=>{"run"!==n.type||n.execute&&"document_ready"!==n.execute?"banner"===n.type&&this.revertQueue.add({fn:H(n,e.params,this.getSDK()),experimentId:t,trigger:e.trigger_type}):this.revertQueue.add({fn:Q(n,e.params,this.getSDK()),experimentId:t,trigger:e.trigger_type})}))}))},a()?t({}):document.addEventListener("DOMContentLoaded",t)}getSDK(){return w()?function(){let e=!1;return{initialize(){},track(){},trackLink(){},identify(){},update(){},anonymize(){},_revealPage(){},configuration:{},notifications:{isAvailable:e=>(e(!0),!0),isSubscribed:t=>(t(e,!1),e),subscribe(t){setTimeout((()=>{e=!0,t("subscribed")}),500)},unsubscribe(t){setTimeout((()=>{e=!1,t("unsubscribed")}),500)}}}}():window[this.config.sdkObjectName]}trackExperiments(e){e.forEach((e=>{w()||(ce.setLastShow(e.params.experiment_id,this.config.sdkObjectName),this.alreadyTrackedExperimentsById[e.params.experiment_id]||(this.getSDK().track("experiment",{action:"show",experiment_id:e.params.experiment_id,experiment_name:e.params.experiment_name,variant_id:e.params.variant_id,variant_name:e.params.variant_name,location:window.location.href,path:window.location.pathname}),this.alreadyTrackedExperimentsById[e.params.experiment_id]=!0))}))}loadRemainingDataIfNeeded(e=!1,t){return I(this,void 0,void 0,(function*(){if(e||this.config.makeAsyncCall||200!==this.config.status){const n=200===this.config.status;let r=this.config.path+"/webxp/data/modifications/"+this.config.sign+"/v1",s=!1;r+="?http-referer="+encodeURIComponent(location.href),!e&&n||(r+="&allModifications=true",s=!0),r+=`&trigger=${t}`;let o=this.config.asyncCallVars;const a=e=>!!e.page_vars;if(e||!n){o=(yield this.metaDataPromise).filter(a).flatMap((e=>e.page_vars))}let c,l;if(null==o?void 0:o.length){const e=U.evaluatePageVars(this.config.vars,o);if(e){const t={page_vars:e};let n;try{n=JSON.stringify(t)}catch(t){i(`Error serializing ${e} to json.`,t)}t&&(c={method:"POST",headers:{"Content-Type":"application/json"},body:n})}}try{l=yield oe(window,r,c)}catch(e){}return this.processResponse(l,s)}}))}applyAllExperiments(e){this.experiments.forEach((t=>{t.modifications.forEach((n=>{this.applyModificationOnElement(e,n,t)}))}))}reapplyExperiments(){if(this.config.legacyFlickeringMode)this.applyExperimentsOnAllElements();else{const e=this.config.rootElement;e&&this.traverseNode(e)}}traverseNode(e){const t=e.nextElementSibling;this.applyAllExperiments(e),e.firstElementChild&&this.traverseNode(e.firstElementChild),t&&this.traverseNode(t)}applyExperimentsOnAllElements(){for(const e of this.experiments)for(const t of e.modifications){const n=je(Le(t));for(const r of n)this.applyModificationOnElement(r,t,e)}}isExperimentRunning(e){return this.experiments.some((t=e,e=>e.params.experiment_id===t));var t}startExperiment(e){this.isExperimentRunning(e.params.experiment_id)||(i(`Starting experiment ${e.params.experiment_id}`),this.applyExperiments([e],!0))}stopExperiment(e){this.isExperimentRunning(e)&&(i(`Stopping experiment ${e}`),this.revertQueue.revertExperiment(e),this.experiments=this.experiments.filter((t=>t.params.experiment_id!==e)))}revealPage(){const e=this.getSDK();e._revealPage&&"function"==typeof e._revealPage&&e._revealPage()}processResponse(e,t=!1){e&&e.data&&(i(`Adding new experiments data, ${e.data}, to current data.`),Oe(this.config.data,e.data),t&&(this.config.vars=e.vars),i("Applying new experiments data ..."),this.applyExperiments(e.data,!0))}}function Le(e){const t=[],n=e=>{"string"==typeof e&&t.push(e)};return n(e.element),e.place_to&&n(e.place_to.element),t}function je(e){return e.flatMap((e=>Array.from(document.querySelectorAll(e)))).filter((e=>e instanceof HTMLElement))}S([Ce,k("design:type",Function),k("design:paramtypes",[Boolean,String]),k("design:returntype",void 0)],Ae.prototype,"init",null),S([Ce,k("design:type",Function),k("design:paramtypes",[Object]),k("design:returntype",Function)],Ae.prototype,"applyModifications",null),S([Ce,k("design:type",Function),k("design:paramtypes",[String]),k("design:returntype",void 0)],Ae.prototype,"reset",null),S([Ce,k("design:type",Function),k("design:paramtypes",[]),k("design:returntype",void 0)],Ae.prototype,"revert",null);const Me=Object.assign(Object.assign({},t),window.webxpClient),Re=new Ae(Me);if(window.webxpClient={init:Re.init.bind(Re),revert:Re.revert.bind(Re),applyModifications:Re.applyModifications.bind(Re),config:Re.config,skipExperiments:Me.skipExperiments,reset:Re.reset.bind(Re)},Re.config.legacyFlickeringMode&&function(){if(!function(){try{const e="___storage_test__";return sessionStorage.setItem(e,e),sessionStorage.removeItem(e),!0}catch(e){return!1}}())return!1;try{return!!window.sessionStorage.getItem("exponea-editor-params")}catch(e){return!1}}()){const e=Re.config.sdk;e._revealPage&&"function"==typeof e._revealPage&&e._revealPage()}else Re.init()}();
